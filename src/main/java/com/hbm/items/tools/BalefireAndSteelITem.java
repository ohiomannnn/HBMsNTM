package com.hbm.items.tools;

import com.hbm.HBMsNTM;
import com.hbm.blocks.ModBlocks;
import net.minecraft.core.BlockPos;
import net.minecraft.sounds.SoundEvents;
import net.minecraft.sounds.SoundSource;
import net.minecraft.world.InteractionHand;
import net.minecraft.world.InteractionResult;
import net.minecraft.world.entity.EquipmentSlot;
import net.minecraft.world.item.Item;
import net.minecraft.world.item.ItemStack;
import net.minecraft.world.item.context.UseOnContext;
import net.minecraft.world.level.Level;
import net.minecraft.world.entity.player.Player;

public class BalefireAndSteelITem extends Item {

    public BalefireAndSteelITem(Properties properties) {
        super(properties);
    }

    @Override
    public InteractionResult useOn(UseOnContext context) {
        Level level = context.getLevel();
        BlockPos pos = context.getClickedPos().relative(context.getClickedFace());
        Player player = context.getPlayer();
        ItemStack stack = context.getItemInHand();

        if (player == null || !player.mayUseItemAt(pos, context.getClickedFace(), stack)) {
            return InteractionResult.FAIL;
        }

        if (level.isEmptyBlock(pos) && !player.isCrouching()) {
            HBMsNTM.LOGGER.info("set balefire at {}", pos);
            level.setBlock(pos, ModBlocks.BALEFIRE.get().defaultBlockState(), 3);
            level.playSound(null,
                    pos.getX() + 0.5D,
                    pos.getY() + 0.5D,
                    pos.getZ() + 0.5D,
                    SoundEvents.FLINTANDSTEEL_USE,
                    SoundSource.BLOCKS,
                    1.0F,
                    level.random.nextFloat() * 0.4F + 0.8F);
        } else if (level.isEmptyBlock(pos) && player.isCrouching()) {
            HBMsNTM.LOGGER.info("set digamma at {}", pos);
            level.setBlock(pos, ModBlocks.FIRE_DIGAMMA.get().defaultBlockState(), 3);
            level.playSound(null,
                    pos.getX() + 0.5D,
                    pos.getY() + 0.5D,
                    pos.getZ() + 0.5D,
                    SoundEvents.FLINTANDSTEEL_USE,
                    SoundSource.BLOCKS,
                    1.0F,
                    level.random.nextFloat() * 0.4F + 0.8F);
        }

        EquipmentSlot slot = (context.getHand() == InteractionHand.MAIN_HAND)
                ? EquipmentSlot.MAINHAND
                : EquipmentSlot.OFFHAND;

        stack.hurtAndBreak(1, player, slot);
        return InteractionResult.SUCCESS;
    }
}